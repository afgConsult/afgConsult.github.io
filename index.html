<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alex Francisco Gomez Portfolio</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
        }
        .header {
            background-color: #007BFF;
            color: white;
            text-align: left;
            padding: 20px 20px 20px 0;
        }
        .container {
            width: 80%;
            margin: 0 auto;
            padding-top: 20px;
            display: flex;
            flex-direction: column;  /* Change from row to column */
            gap: 20px;
        }
        .report-container {
            margin-bottom: 30px;
            display: none;
        }
        iframe {
            width: 100%;
            height: 800px;
            border: none;
        }
        .description {
            margin-top: 20px;
            padding: 20px;
            background-color: #ffffff;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            height: 300px;
            overflow-y: auto;
        }
        .tables-menu {
            width: 100%;  /* Take full width instead of fixed width */
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .tables-menu h2 {
            margin-top: 0;
            color: #333;
        }

        .table-button {
            flex: 1;  /* Allow buttons to grow */
            min-width: 150px;  /* Minimum width for buttons */
            padding: 10px;
            margin: 0;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .table-button:hover {
            background: #e9ecef;
        }

        .table-button.active {
            background: #007bff;
            color: white;
        }

        .content-area {
            width: 100%;  /* Take full width */
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .calculation {
            margin-bottom: 10px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
        }

        .calc-header {
            padding: 10px 15px;
            background: #f8f9fa;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .calc-description {
            display: none;
            padding: 15px;
            border-top: 1px solid #dee2e6;
            background: #fff;
        }

        .dax-code {
            display: none;
            padding: 15px;
            background: #f8f9fa;
            border-top: 1px solid #dee2e6;
            font-family: 'Consolas', monospace;
            white-space: pre-wrap;
        }

        .measure-badge {
            background: #28a745;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 12px;
        }

        .table-section {
            display: none;
        }

        .table-section.active {
            display: block;
        }

        .toggle-buttons {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            justify-content: flex-start;  /* Change from center to flex-start */
            width: 100%;
        }

        .toggle-buttons button {
            flex: 0 0 auto;  /* Change from flex: 0 1 200px to prevent stretching */
            min-width: 150px;
            padding: 10px 20px;
            font-size: 16px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            color: #333;
            cursor: pointer;
            transition: all 0.2s;
        }

        .toggle-buttons button:hover {
            background: #e9ecef;
        }

        .toggle-buttons button.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Alex Francisco Gomez Portfolio</h1>
    </div>

    <div class="container">
        <h2>Power BI Reports</h2>
        <a href="https://app.powerbi.com/home?ctid=ac79e5a8-e0e4-434b-a292-2c89b5c28366" 
           target="_blank" 
           style="display: block; margin-bottom: 20px; color: #007BFF; text-decoration: none;">
            Click the here for access to report <span style="font-size: 0.8em;">â†—</span>
        </a>

        <div class="toggle-buttons" style="text-align: left;">
            <button onclick="showReport('sampleReport')">Sample Report</button>
            <button onclick="showReport('sampleMetrics')">Sample Metrics</button>
        </div>

        <div class="report-container" id="sampleReport">
            <h3>Sample Report</h3>
            <iframe title="SampleReport" width="1140" height="541.25" src="https://app.powerbi.com/reportEmbed?reportId=5a4add2e-104a-449e-b140-d1937b453bda&autoAuth=true&ctid=ac79e5a8-e0e4-434b-a292-2c89b5c28366" frameborder="0" allowFullScreen="true"></iframe>
        </div>

        <div class="report-container" id="sampleMetrics">
            <h3>Sample Metrics</h3>
                        <object 
                data="/Portfolio/assets/SampleMetrics.pdf" 
                type="application/pdf"
                width="100%" 
                height="800px">
                <div class="pdf-fallback">
                    <p>Your browser does not support PDFs. You can download the PDF here: 
                        <a href="/Portfolio/assets/SampleMetrics.pdf">Download Sample Metrics PDF</a>
                    </p>
                </div>
            </object>
        </div>

        <div class="description" id="descriptionText">
            <h3>Description:</h3>
            <div id="reportDescription"></div>
        </div>

        <h2>Power BI Calculations</h2>
        <div class="calculation-description" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #007bff;">
            <p>These calculations were developed by me to ensure accurate data population within PowerBI and to track key metrics required by management and Standard Operating Procedures (SOPs). Each calculation serves a specific purpose in monitoring workflow efficiency, quality control, and compliance with established standards.</p>
        </div>
        <div class="tables-menu">
            <h2>Tables</h2>
            <button class="table-button" data-table="CheckIn">CheckIn</button>
            <button class="table-button" data-table="DEOut">DEOut</button>
            <button class="table-button" data-table="Findings">Findings</button>
            <button class="table-button" data-table="CalculatedTables">Calculated Tables</button>
            <button class="table-button" data-table="CTMS">CTMS</button>
        </div>

        <div class="content-area">
            <div id="CheckIn" class="table-section"></div>
            <div id="DEOut" class="table-section"></div>
            <div id="Findings" class="table-section"></div>
            <div id="CalculatedTables" class="table-section"></div>
            <div id="CTMS" class="table-section"></div>
        </div>
    </div>

    <script>
        const descriptions = {
            sampleReport: `Sample Report is used by staff for clinical operations and quality control. The report contains:
            <ul>
                <li><strong>Pending Check In:</strong> Displays subjects that have come into the office and seen front desk. The clinical research coordinator must check these charts into QC for them to depopulate.
                    <ul>
                        <li>Pending Check In Count: Displays a quick numeric value for staff to review the number of pending charts. Vital for individual staff and main CRCs.</li>
                        <li>Shows when the Visit occurred for urgency</li>
                        <li>Staff filter: Allows CRCs to focus on individual tasks</li>
                        <li>Subject filter: Allows for a study-level filter as well for main CRCs</li>
                        <li>Date filter: To prioritize visits</li>
                    </ul>
                </li>
                <li><strong>Pending Response:</strong> Shows findings issued by QC that have not been responded to by clinical staff.
                    <ul>
                        <li>Count of Findings: Displays a quick numeric value for staff to review the amount of findings they have. Vital for individual staff and main CRCs.</li>
                        <li>Issued by: When a finding is selected, the QC staff that issued the finding populates.</li>
                    </ul>
                </li>
                <li><strong>Pending QC:</strong> Lists charts that have been checked in by clinical staff and have not yet been QC'd.
                    <ul>
                        <li>Color coordination populates when a visit that has been checked in is older than two days.</li>
                    </ul>
                </li>
                <li><strong>Pending Verification:</strong> Shows findings that have been responded to and have not been verified yet.
                    <ul>
                        <li>Center table populates findings that have been responded to, along with the number of days it took to respond to the finding.</li>
                        <li>Top right table populates the responses when a row is selected.</li>
                    </ul>
                </li>
                <li><strong>Findings Directory and Visit Directory:</strong> Lists out all visits and findings.</li>
            </ul>`,
            sampleMetrics: `Sample Metrics provides comprehensive performance tracking across different staff roles:
            <ul>
                <li><strong>Clinical Time Metrics:</strong> Measures the average number of days it takes staff to respond to findings.</li>
                <li><strong>Clinical Count Metrics:</strong> Tracks the number of findings issued to each staff member.</li>
                <li><strong>QC Staff Metrics:</strong> Provides detailed Quality Control Measures for:
                    <ul>
                        <li>Findings per Visit</li>
                        <li>Findings count issued by QC staff</li>
                        <li>Number of charts checked in</li>
                        <li>Number of charts QC'd</li>
                        <li>Percentage of checked-in charts that have been QC'd</li>
                    </ul>
                </li>
                <li><strong>Chart Metrics:</strong> Monitors chart processing timeline:
                    <ul>
                        <li>Days between visit date and check-in</li>
                        <li>Days between check-in and QC completion</li>
                        <li>Current status counts:
                            <ul>
                                <li>Pending check-in</li>
                                <li>Pending QC</li>
                                <li>Completed QC</li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li><strong>Findings Metrics:</strong> Comprehensive findings tracking:
                    <ul>
                        <li>Number of findings per visit</li>
                        <li>Total findings pending response</li>
                        <li>Total findings pending verification</li>
                        <li>Findings trends over time</li>
                    </ul>
                </li>
                <li><strong>Turn Around Time:</strong> QC efficiency metrics:
                    <ul>
                        <li>Time from check-in to QC completion</li>
                        <li>Performance against 3-day target</li>
                        <li>Average QC completion time</li>
                        <li>Trending analysis</li>
                    </ul>
                </li>
                <li><strong>CRC Accountability:</strong> Clinical staff performance tracking:
                    <ul>
                        <li>Findings per visit over time</li>
                        <li>Severity breakdown (major/critical)</li>
                        <li>Individual trending analysis</li>
                        <li>Response time metrics</li>
                    </ul>
                </li>
                <li><strong>Personal Finding Log:</strong> QC staff performance metrics:
                    <ul>
                        <li>Number of findings issued per visit</li>
                        <li>Chart completion time tracking</li>
                        <li>Individual productivity metrics</li>
                        <li>Quality consistency analysis</li>
                    </ul>
                </li>
            </ul>`
        };

        function showReport(reportId) {
            // Remove active class from all buttons
            document.querySelectorAll('.toggle-buttons button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Add active class to clicked button
            document.querySelector(`.toggle-buttons button[onclick*="${reportId}"]`).classList.add('active');
            
            // Show/hide containers
            document.getElementById('sampleReport').style.display = 'none';
            document.getElementById('sampleMetrics').style.display = 'none';
            document.getElementById('descriptionText').style.display = 'none';
            document.getElementById(reportId).style.display = 'block';
            document.getElementById('descriptionText').style.display = 'block';

            // Update description
            document.getElementById('reportDescription').innerHTML = descriptions[reportId];
        }
        // Initialize with sampleReport and active state
        showReport('sampleReport');

        const calculationsData = {
            CheckIn: [
                {
                    name: 'ZzAge',
                    description: 'Continuous variable for number of business days since submission.',
                    dax: `COUNTROWS(
    FILTER(
        'CalendarTable',
        'CalendarTable'[Date] >= [Check-In Date] &&
        'CalendarTable'[Date] <= TODAY() &&
        'CalendarTable'[IsBusinessDay] = TRUE
    )
) - 1`,
                    isMeasure: false
                },
                {
                    name: 'ZzCheckAge',
                    description: 'Continuous Variable for dates from Visit to when checked in.',
                    dax: `IF(
    ISBLANK(RELATED(CTMS[Visit By:Date])),
    DATEDIFF(TODAY(), RELATED(CTMS[Visit By:Date]), DAY),
    DATEDIFF(CheckIn[Check-In Date], RELATED(CTMS[Visit By:Date]), DAY)
)`,
                    isMeasure: false
                },
                {
                    name: 'ZZCriticalCount',
                    description: 'Continuous variable, counts of number of critical findings.',
                    dax: `IF(
    ISBLANK(
        CALCULATE(
            COUNTROWS(Findings1),
            FILTER(
                Findings1, 
                Findings1[Visit Key] = EARLIER(CheckIn[Visit Key]) &&
                Findings1[Follow Up] = "Critical - Follow Up"
            )
        )
    ),
    0,
    CALCULATE(
        COUNTROWS(Findings1),
        FILTER(
            Findings1, 
            Findings1[Visit Key] = EARLIER(CheckIn[Visit Key]) &&
            Findings1[Follow Up] = "Critical - Follow Up"
        )
    )
)`,
                    isMeasure: false
                },
                {
                    name: 'ZzFindingsCount',
                    description: 'Continuous variable, counts of number of findings for a chart.',
                    dax: `IF(
    ISBLANK(
        CALCULATE(
            COUNTROWS(Findings1),
            FILTER(
                Findings1, 
                Findings1[Visit Key] = EARLIER(CheckIn[Visit Key]) &&
                NOT (Findings1[Category] = "None" || Findings1[Category] = "All Good")
            )
        )
    ),
    0,
    CALCULATE(
        COUNTROWS(Findings1),
        FILTER(
            Findings1, 
            Findings1[Visit Key] = EARLIER(CheckIn[Visit Key]) &&
            NOT (Findings1[Category] = "None" || Findings1[Category] = "All Good")
        )
    )
)`,
                    isMeasure: false
                },
                {
                    name: 'ZzMajorCount',
                    description: 'Continuous variable, counts the number of major findings.',
                    dax: `IF(
    ISBLANK(
        CALCULATE(
            COUNTROWS(Findings1),
            FILTER(
                Findings1, 
                Findings1[Visit Key] = EARLIER(CheckIn[Visit Key]) &&
                Findings1[Follow Up] = "Major - Follow Up"
            )
        )
    ),
    0,
    CALCULATE(
        COUNTROWS(Findings1),
        FILTER(
            Findings1, 
            Findings1[Visit Key] = EARLIER(CheckIn[Visit Key]) &&
            Findings1[Follow Up] = "Major - Follow Up"
        )
    )
)`,
                    isMeasure: false
                },
                {
                    name: 'ZzNewest',
                    description: 'Binary variable for latest submission chart checkin submission for a Subject/Visit.',
                    dax: `VAR MaxTimeSubmitted =
    CALCULATE(
        MAX(CheckIn[ZzTimeStamp]),
        ALLEXCEPT(CheckIn, 'CheckIn'[Study], 'CheckIn'[Subject Number], 'CheckIn'[Visit])
    )
RETURN IF('CheckIn'[ZzTimeStamp] = MaxTimeSubmitted, 1, 0)`,
                    isMeasure: false
                },
                {
                    name: 'ZzPriority',
                    description: 'Categorical variable, Yellow when ZzAge eq 2 and Red when gt 2.',
                    dax: `VAR AgeValue = SELECTEDVALUE('CheckIn'[ZzAge])
RETURN 
    IF(AgeValue = 2, "#FFFF00", IF(AgeValue > 2, "#FF0000", BLANK()))`,
                    isMeasure: true
                },
                {
                    name: 'ZzQCAge',
                    description: 'Continuous Variable for dates from Check In to when QC\'d.',
                    dax: `IF(
    ISBLANK(Related(DEOut[QC Date])),
    DATEDIFF(TODAY(), Related(DEOut[QC Date]), DAY),
    DATEDIFF(CheckIn[Check-In Date], RELATED(DEOut[QC Date]), DAY)
)`,
                    isMeasure: false
                },
                {
                    name: 'ZzSignificance',
                    description: 'Continuous variable, counts types of findings per visit.',
                    dax: `VAR VisitKey = SELECTEDVALUE(CheckIn[Visit Key])
VAR FollowUpValues = 
    CALCULATETABLE(
        VALUES('Findings1'[Follow Up]),
        'Findings1'[Visit Key] = VisitKey
    )
VAR HasCritical = CONTAINSSTRING(CONCATENATEX(FollowUpValues, [Follow Up], ","), "Critical")
VAR HasMajor = CONTAINSSTRING(CONCATENATEX(FollowUpValues, [Follow Up], ","), "Major")
VAR HasNormal = CONTAINSSTRING(CONCATENATEX(FollowUpValues, [Follow Up], ","), "Normal")

RETURN
IF(
    COUNTROWS(FollowUpValues) = 0,
    "Pending",
    IF(
        HasCritical && HasMajor,
        "Critical and Major",
        IF(
            HasCritical,
            "Critical",
            IF(
                HasMajor,
                "Major",
                IF(
                    HasNormal,
                    "Normal",
                    "Pending"
                )
            )
        )
    )
)`,
                    isMeasure: true
                },
                {
                    name: 'ZzStatus',
                    description: 'Binary variable for if chart is checked in or checked out.',
                    dax: `IF (
    NOT ( ISBLANK ( RELATED ( 'DEOut'[Visit Key]) ) )
        || NOT ( ISBLANK ( RELATED ('CheckOut'[Visit Key]) ) ),
    "Out",
    "In"
)`,
                    isMeasure: false
                },
                {
                    name: 'ZzTimeStamp',
                    description: 'Date variable to combine date and time.',
                    dax: `VAR TimeStampString = CheckIn[Check-In Date] & " " & CheckIn[Check In Time]
RETURN DATEVALUE(TimeStampString) + TIMEVALUE(TimeStampString)`,
                    isMeasure: false
                },
                {
                    name: 'ZzTurnAround',
                    description: 'Continuous variable, counts the number of days to complete a visit.',
                    dax: `VAR CheckInDate = 'CheckIn'[Check-In Date]
VAR QCDate = RELATED('DEOut'[QC Date])
VAR EndDate = IF(ISBLANK(QCDate), TODAY(), QCDate)
RETURN
    COUNTROWS(
        FILTER(
            'CalendarTable',
            'CalendarTable'[Date] >= CheckInDate &&
            'CalendarTable'[Date] <= EndDate &&
            'CalendarTable'[IsBusinessDay] = TRUE()
        )
    ) - 1`,
                    isMeasure: false
                },
                {
                    name: 'ZzTurnAroundCount',
                    description: 'Continuous variable, counts the number of charts that take less than 3 days to complete.',
                    dax: `COUNTROWS(
    FILTER(
        CheckIn,
        CheckIn[ZzTurnAround] < 3
    )
)`,
                    isMeasure: true
                },
                {
                    name: 'ZzTurnAroundPCT',
                    description: 'Continuous, percent of charts done under 2days minus the ones checked out by clinical staff.',
                    dax: `DIVIDE(
    [ZzTurnAroundCount] - COUNT('CheckOut'[Visit Key]), 
    COUNTA('CheckIn'[ZzTurnAround]) - COUNT('CheckOut'[Visit Key])
)`,
                    isMeasure: true
                },
                {
                    name: 'ZzWeekofCheckIn',
                    description: 'Categorical variable, group of days by work week.',
                    dax: `VAR StartOfWeek = 'Checkin'[Check-in Date] - WEEKDAY('Checkin'[Check-in Date], 2) + 1
VAR EndOfWeek = StartOfWeek + 4
RETURN FORMAT(StartOfWeek, "dd-mmm-yyyy") & " - " & FORMAT(EndOfWeek, "dd-mmm-yyyy")`,
                    isMeasure: false
                }
            ],
            DEOut: [
                {
                    name: 'ZzChartTime',
                    description: 'Continuous Variable, time difference between the Start of a chart and DeOut',
                    dax: `IF(
    ISBLANK(RELATED(ChartStart[Visit Key])) || ISBLANK(DEOut[QC Time]) || ISBLANK(RELATED(ChartStart[Start By:Time])),
    0,
    ABS(
        (HOUR(RELATED(ChartStart[Start By:Time])) * 60 + MINUTE(RELATED(ChartStart[Start By:Time]))) - 
        (HOUR(DEOut[QC Time]) * 60 + MINUTE(DEOut[QC Time]))
    )
)`,
                    isMeasure: false
                },
                {
                    name: 'ZzPendingCheckIn',
                    description: 'Continuous Variable, count of charts pending QC',
                    dax: `COUNTA('CheckIn'[Visit Key]) - COUNTA('DEOut'[Visit Key])`,
                    isMeasure: false
                },
                {
                    name: 'ZzPlogMetric',
                    description: 'Continuous Variable, Count of Findings per Visit',
                    dax: `VAR VisitKey = DEOut[Visit Key]
VAR VisitCount = 
    CALCULATE(
        COUNTROWS(Findings1),
        Findings1[Visit Key] = VisitKey,
        Findings1[Category] <> "None"
    )
RETURN
    IF(ISBLANK(VisitCount), 0, VisitCount)`,
                    isMeasure: false
                },
                {
                    name: 'ZzWeekOfQC',
                    description: 'Categorical Variable, group of days for a given week.',
                    dax: `VAR StartOfWeek = 'DEOut'[QC Date] - WEEKDAY('DEOut'[QC Date], 2) + 1
VAR EndOfWeek = StartOfWeek + 4
RETURN FORMAT(StartOfWeek, "dd-mmm-yyyy") & " - " & FORMAT(EndOfWeek, "dd-mmm-yyyy")`,
                    isMeasure: false
                }
            ],
            Findings: [
                {
                    name: 'ZzCompletion Time',
                    description: 'Continuous variable for time between Findings issued and findings verified.',
                    dax: `IF(
    ISBLANK(RELATED('Response'[Completed By:Date])),
    COUNTROWS(
        FILTER(
            'CalendarTable',
            'CalendarTable'[Date] >= 'Findings1'[Review Date] &&
            'CalendarTable'[Date] <= TODAY() &&
            'CalendarTable'[IsBusinessDay] = TRUE
        )
    ) - 1,
    IF(
        ISBLANK(RELATED('Verify'[Verified By:Date])),
        COUNTROWS(
            FILTER(
                'CalendarTable',
                'CalendarTable'[Date] >= 'Findings1'[Review Date] &&
                'CalendarTable'[Date] <= TODAY() &&
                'CalendarTable'[IsBusinessDay] = TRUE
            )
        ) - 1,
        COUNTROWS(
            FILTER(
                'CalendarTable',
                'CalendarTable'[Date] >= 'Findings1'[Review Date] &&
                'CalendarTable'[Date] <= RELATED('Verify'[Verified By:Date]) &&
                'CalendarTable'[IsBusinessDay] = TRUE
            )
        )
    )
)`,
                    isMeasure: false
                },
                {
                    name: 'ZzResponse Time',
                    description: 'Continuous variable for time between Findings issued and finding Responded to by Clinical.',
                    dax: `IF(
    ISBLANK(RELATED('Response'[Completed By:Date])),
    COUNTROWS(
        FILTER(
            'CalendarTable',
            'CalendarTable'[Date] >= 'Findings1'[Review Date] &&
            'CalendarTable'[Date] <= TODAY() &&
            'CalendarTable'[IsBusinessDay] = TRUE
        )
    ) - 1,
    COUNTROWS(
        FILTER(
            'CalendarTable',
            'CalendarTable'[Date] >= 'Findings1'[Review Date] &&
            'CalendarTable'[Date] <= RELATED('Response'[Completed By:Date]) &&
            'CalendarTable'[IsBusinessDay] = TRUE
        )
    ) - 1
)`,
                    isMeasure: false
                },
                {
                    name: 'ZzStatus',
                    description: 'Categorical variable, if findings in pending Response or has been responded to.',
                    dax: `IF(
    ISBLANK(RELATED('Verify'[Verified By:Date])),
    IF(
        ISBLANK(RELATED('Response'[Completed By:Date])),
        "Pending",
        "Responded"
    ),
    "Completed"
)`,
                    isMeasure: false
                },
                {
                    name: 'ZzUrgent',
                    description: 'Categorical variable, Yellow/Red.',
                    dax: `SWITCH(
    TRUE(),
    SELECTEDVALUE('Findings1'[Follow Up]) = "Normal", BLANK(),
    SELECTEDVALUE('Findings1'[Follow Up]) = "Major", "Yellow",
    SELECTEDVALUE('Findings1'[Follow Up]) = "Critical", "Red",
    BLANK()  
)`,
                    isMeasure: true
                },
                {
                    name: 'ZzWeekofFindings',
                    description: 'Categorical Variable, group of dates by week.',
                    dax: `VAR StartOfWeek = 'Findings1'[Review Date] - WEEKDAY('Findings1'[Review Date], 2) + 1
VAR EndOfWeek = StartOfWeek + 4
RETURN FORMAT(StartOfWeek, "dd-mmm-yyyy") & " - " & FORMAT(EndOfWeek, "dd-mmm-yyyy")`,
                    isMeasure: false
                },
                {
                    name: 'ZzXcount',
                    description: 'Continuous variable for number of yes values in the Findings[Follow up] column.',
                    dax: `CALCULATE(
    COUNTA('Findings1'[Visit Completed by]),
    'Findings1'[Follow Up] = "Major" || 'Findings1'[Follow Up] = "Critical"
)`,
                    isMeasure: false
                }
            ],
            CalculatedTables: [
                {
                    name: 'CalendarTable',
                    description: 'Table made for wide date options for all data.',
                    dax: `ADDCOLUMNS (
    CALENDAR (DATE(2020, 1, 1), DATE(YEAR(TODAY()) + 1, MONTH(TODAY()), DAY(TODAY()))),
    "Year", YEAR([Date]),
    "Month", MONTH([Date]),
    "Day", DAY([Date]),
    "DayOfWeek", WEEKDAY([Date]),
    "DayName", FORMAT([Date], "dddd"),
    "IsWeekday", IF(WEEKDAY([Date], 2) < 6, TRUE, FALSE),
    "IsWeekend", IF(WEEKDAY([Date], 2) >= 6, TRUE, FALSE),
    "IsHoliday", 
        IF (
            [Date] = DATE(YEAR([Date]), 1, 1) ||  // New Year's Day
            [Date] = DATE(YEAR([Date]), 1, 20) ||  // MLK Day 
            [Date] = DATE(YEAR([Date]), 7, 4) ||  // Independence Day
            [Date] = DATE(YEAR([Date]), 12, 24) ||  // Christmas Eve
            [Date] = DATE(YEAR([Date]), 12, 25) ||  // Christmas Day
            [Date] = DATE(YEAR([Date]), 12, 31) ||  // New Year's Eve
            [Date] = DATE(YEAR([Date]), 11, 25) ||  // Thanksgiving 
            [Date] = DATE(YEAR([Date]), 11, 26),  // Day after Thanksgiving 
            TRUE, FALSE
        ),
    "IsBusinessDay", 
        IF (
            IF(WEEKDAY([Date], 2) < 6, TRUE, FALSE) = TRUE() && 
            IF (
                [Date] = DATE(YEAR([Date]), 1, 1) ||  // New Year's Day
                [Date] = DATE(YEAR([Date]), 1, 20) ||  // MLK Day 
                [Date] = DATE(YEAR([Date]), 7, 4) ||  // Independence Day
                [Date] = DATE(YEAR([Date]), 12, 24) ||  // Christmas Eve
                [Date] = DATE(YEAR([Date]), 12, 25) ||  // Christmas Day
                [Date] = DATE(YEAR([Date]), 12, 31) ||  // New Year's Eve
                [Date] = DATE(YEAR([Date]), 11, 25) ||  // Thanksgiving 
                [Date] = DATE(YEAR([Date]), 11, 26),  // Day after Thanksgiving
                TRUE, FALSE
            ) = FALSE(),
            TRUE, 
            FALSE
        )
)`,
                    isMeasure: false
                }
            ],
            CTMS: [
                {
                    name: 'ZzTurnAroundCTMS',
                    description: 'Continuous variable, counts the number of days to complete a visit.',
                    dax: `VAR CheckInDate = 'CTMS'[Visit By:Date]
VAR QCDate = RELATED('DEOut'[QC Date])
VAR EndDate = IF(ISBLANK(QCDate), TODAY(), QCDate)
RETURN
    COUNTROWS(
        FILTER(
            'CalendarTable',
            'CalendarTable'[Date] >= CheckInDate &&
            'CalendarTable'[Date] <= EndDate &&
            'CalendarTable'[IsBusinessDay] = TRUE()
        )
    ) - 1`,
                    isMeasure: false
                },
                {
                    name: 'ZzTurnAroundCountCTMS',
                    description: 'Continuous variable, counts the number of charts that take less than 3 days to complete.',
                    dax: `COUNTROWS(
    FILTER(
        CTMS,
        CTMS[ZzTurnAroundCTMS] < 3
    )
)`,
                    isMeasure: true
                },
                {
                    name: 'ZzTurnAroundPCT_CTMS',
                    description: 'Continuous, percent of charts done under 2days minus the ones checked out by clinical staff.',
                    dax: `DIVIDE(
    [ZzTurnAroundCountCTMS] - COUNT('CheckOut'[Visit Key]), 
    COUNTA('CTMS'[Visit Key]) - COUNT('CheckOut'[Visit Key])
)`,
                    isMeasure: true
                }
            ]
        };

        document.addEventListener('DOMContentLoaded', function() {
            const tableButtons = document.querySelectorAll('.table-button');
            
            function createCalculationElement(calc) {
                return `
                    <div class="calculation">
                        <div class="calc-header" onclick="toggleCalcContent(this)">
                            <span>${calc.name}</span>
                            ${calc.isMeasure ? '<span class="measure-badge">Measure</span>' : ''}
                        </div>
                        <div class="calc-description">${calc.description}</div>
                        <div class="dax-code">${calc.dax}</div>
                    </div>
                `;
            }

            function loadTableContent(tableId) {
                const tableData = calculationsData[tableId];
                const tableSection = document.getElementById(tableId);
                if (tableData && !tableSection.hasAttribute('data-loaded')) {
                    tableSection.innerHTML = tableData.map(calc => createCalculationElement(calc)).join('');
                    tableSection.setAttribute('data-loaded', 'true');
                }
            }

            tableButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const tableId = this.getAttribute('data-table');
                    
                    // Update active states
                    tableButtons.forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.table-section').forEach(section => section.classList.remove('active'));
                    
                    this.classList.add('active');
                    document.getElementById(tableId).classList.add('active');
                    
                    loadTableContent(tableId);
                });
            });

            // Initialize with first table
            tableButtons[0].click();
        });

        function toggleCalcContent(header) {
            const calculation = header.parentElement;
            const description = calculation.querySelector('.calc-description');
            const daxCode = calculation.querySelector('.dax-code');
            
            const isExpanded = description.style.display === 'block';
            
            // Close all other calculations in the same section
            const section = calculation.closest('.table-section');
            section.querySelectorAll('.calc-description, .dax-code').forEach(el => {
                el.style.display = 'none';
            });

            if (!isExpanded) {
                description.style.display = 'block';
                daxCode.style.display = 'block';
            }
        }
    </script>
</body>
</html>
